<!-- index.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador ST - Reajuste de Plano de Sa√∫de</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 900px;
      margin: auto;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
    }
    .form-group {
      margin: 15px 0;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    input {
      width: 100%;
      padding: 8px;
    }
    button {
      margin-top: 20px;
      padding: 10px 15px;
      background: #0077cc;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    #resultado, #grafico-container {
      margin-top: 40px;
      background: white;
      padding: 20px;
      border-radius: 8px;
    }
    canvas {
      max-width: 100%;
    }
    .logo {
      display: block;
      margin: 30px auto;
      max-width: 200px;
    }
  </style>
</head>
<body>

  <img src="logo.png" alt="Logo" class="logo" />

  <h1>Simulador de Reajuste de Plano de Sa√∫de</h1>

  <div class="form-group">
    <label>Nome do Cliente:</label>
    <input id="nome" required />
  </div>
  <div class="form-group">
    <label>Nome do Plano:</label>
    <input id="plano" required />
  </div>
  <div class="form-group">
    <label>Email:</label>
    <input id="email" required type="email" />
  </div>
  <div class="form-group">
    <label>WhatsApp:</label>
    <input id="whatsapp" required type="tel" />
  </div>
  <div class="form-group">
    <label>Data de Inclus√£o no Plano:</label>
    <input id="inicio" type="month" required />
  </div>
  <div class="form-group">
    <label>Data do √öltimo Pagamento:</label>
    <input id="fim" type="month" required />
  </div>
  <div class="form-group">
    <label>Valor da √öltima Mensalidade (R$):</label>
    <input id="valor" type="number" required />
  </div>

  <button onclick="simular()">Simular</button>

  <div id="resultado"></div>
  <div id="grafico-container">
    <canvas id="grafico"></canvas>
    <button onclick="exportarPDF()">üìÑ Exportar PDF</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const indicesANS = {
      2024: 6.91,
      2023: 9.63,
      2022: 15.50,
      2021: -8.19,
      2020: 8.14,
      2019: 7.35,
      2018: 10.00,
      2017: 13.55,
      2016: 13.57,
      2015: 13.55,
      2014: 9.65,
      2013: 9.04,
      2012: 7.93,
      2011: 7.69,
      2010: 6.73,
      2009: 6.76,
      2008: 5.48,
      2007: 5.76,
      2006: 8.89,
      2005: 11.69,
      2004: 11.75,
      2003: 9.27,
      2002: 7.69,
      2001: 8.71,
      2000: 5.42,
    };

    function simular() {
      const nome = document.getElementById('nome').value;
      const plano = document.getElementById('plano').value;
      const email = document.getElementById('email').value;
      const whatsapp = document.getElementById('whatsapp').value;
      const inicio = new Date(document.getElementById('inicio').value);
      const fim = new Date(document.getElementById('fim').value);
      const valorFinal = parseFloat(document.getElementById('valor').value);

      if (!nome || !email || !whatsapp || !inicio || !fim || !valorFinal) {
        alert("Preencha todos os campos!");
        return;
      }

      let pagos = [];
      let ans = [];
      let meses = [];

      let atualPago = valorFinal;
      let atualANS = valorFinal;
      let data = new Date(fim);
      let entrada = new Date(inicio);
      data.setDate(1);

      while (data >= entrada) {
        const mes = data.toLocaleString('default', { month: 'short' });
        const label = `${mes}/${data.getFullYear()}`;
        meses.unshift(label);
        pagos.unshift(atualPago);

        // ANS ‚Äì Progressivo
        ans.unshift(atualANS);

        // Reajuste ANUAL ‚Äì apenas em OUTUBRO
        if (data.getMonth() === 9) {
          const ano = data.getFullYear();

          // Reajuste real para valor pago: -22%
          atualPago /= 1.22;

          // Reajuste ANS (progressivo)
          const indice = indicesANS[ano] ?? 7;
          atualANS *= 1 + indice / 100;
        }

        // Retrocede m√™s
        data.setMonth(data.getMonth() - 1);
      }

      // Diferen√ßa total
      let totalPago = pagos.reduce((a, b) => a + b, 0);
      let totalANS = ans.reduce((a, b) => a + b, 0);
      let diff = totalPago - totalANS;
      let diff12 = pagos.slice(-12).reduce((a, b, i) => a + (b - ans[ans.length - 12 + i]), 0);

      // Resultado
      document.getElementById("resultado").innerHTML = `
        <h2>Resultado da Simula√ß√£o</h2>
        <p>Voc√™ pagou <strong>R$ ${diff.toFixed(2)}</strong> a mais nos √∫ltimos ${meses.length} meses.</p>
        <p>Se continuar assim, pagar√° <strong>R$ ${diff12.toFixed(2)}</strong> a mais nos pr√≥ximos 12 meses.</p>
      `;

      // Gr√°fico
      const ctx = document.getElementById('grafico').getContext('2d');
      if (window.chartRef) window.chartRef.destroy();
      window.chartRef = new Chart(ctx, {
        type: 'line',
        data: {
          labels: meses,
          datasets: [
            {
              label: 'Valor Pago (Real)',
              data: pagos,
              borderColor: '#0077cc',
              fill: false
            },
            {
              label: 'Valor que deveria ser pago (ANS)',
              data: ans,
              borderColor: '#cc0000',
              fill: false
            }
          ]
        }
      });

      // Pipedrive (opcional)
      fetch('https://api.pipedrive.com/v1/deals?api_token=cd9eb8d752c61cc00505aa73e12bbc1f7289b9c0', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          title: `Simula√ß√£o de ${nome}`,
          person_id: null,
          pipeline_id: 1,
          stage_id: 1,
          value: diff.toFixed(2),
          currency: "BRL"
        })
      });

    }

    function exportarPDF() {
      import('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js').then(jsPDF => {
        const { jsPDF: PDF } = jsPDF;
        const doc = new PDF();
        doc.text(document.getElementById("resultado").innerText, 10, 10);
        doc.addImage(document.getElementById("grafico"), 'PNG', 10, 40, 180, 80);
        doc.save('simulacao.pdf');
      });
    }
  </script>
</body>
</html>

