<!-- HTML do simulador completo (incluindo c√°lculo + integra√ß√£o com Pipedrive) -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Simulador de Reajuste Indevido</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f7fa;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    img.logo {
      width: 200px;
      margin: 20px auto;
      display: block;
    }

    .form {
      background: white;
      padding: 20px;
      max-width: 700px;
      margin: 20px auto;
      border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
      text-align: left;
    }

    label {
      display: block;
      margin: 10px 0 4px;
    }

    input {
      width: 100%;
      padding: 8px;
    }

    button {
      background: #007bff;
      color: white;
      padding: 10px 15px;
      border: none;
      margin-top: 15px;
      border-radius: 5px;
      cursor: pointer;
    }

    .resultado {
      background: #eaf4ff;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
    }

    canvas {
      max-width: 800px;
      margin: 30px auto;
    }

    .botoes {
      margin-top: 20px;
    }

    .botoes button {
      margin: 5px;
    }
  </style>
</head>
<body>

  <img src="logo.png" class="logo" alt="Logo Sa√∫de Transparente">

  <div class="form">
    <label>Nome do Cliente:</label>
    <input type="text" id="nomeCliente" placeholder="Ex: Jo√£o Silva" />

    <label>Nome do Plano de Sa√∫de:</label>
    <input type="text" id="nomePlano" placeholder="Ex: Unimed Empresarial" />

    <label>E-mail:</label>
    <input type="email" id="email" placeholder="Ex: joao@email.com" />

    <label>WhatsApp:</label>
    <input type="tel" id="whatsapp" placeholder="Ex: (11) 91234-5678" />

    <label>Data de Entrada no Plano:</label>
    <input type="month" id="dataInicio" value="2020-11" />

    <label>Data do √öltimo Pagamento:</label>
    <input type="month" id="dataFim" value="2025-02" />

    <label>Valor da √öltima Mensalidade (R$):</label>
    <input type="number" id="valorAtual" value="4000" />

    <button onclick="simular()">Simular</button>

    <div class="resultado" id="resultado"></div>

    <canvas id="grafico"></canvas>

    <div class="botoes">
      <button onclick="exportarPDF()">üìÑ Exportar PDF</button>
      <button onclick="compartilharWhatsApp()">üì≤ Compartilhar WhatsApp</button>
    </div>
  </div>

  <script>
    const reajusteReal = 0.18; // 18% ao ano
    const reajusteANS = 0.07;  // 7% ao ano
    const mesReajuste = 9; // Outubro (indexado como 9)

    function formatarMesAno(data) {
      return new Intl.DateTimeFormat('pt-BR', { month: 'short', year: 'numeric' }).format(data);
    }

    function simular() {
      const nome = document.getElementById('nomeCliente').value;
      const plano = document.getElementById('nomePlano').value;
      const email = document.getElementById('email').value;
      const whatsapp = document.getElementById('whatsapp').value;
      const inicio = new Date(document.getElementById('dataInicio').value);
      const fim = new Date(document.getElementById('dataFim').value);
      const valorFinal = parseFloat(document.getElementById('valorAtual').value);

      let meses = [];
      let valoresPagos = [];
      let valoresANS = [];

      const diffMeses = (fim.getFullYear() - inicio.getFullYear()) * 12 + (fim.getMonth() - inicio.getMonth()) + 1;
      let valorPago = valorFinal / Math.pow(1 + reajusteReal, Math.floor(diffMeses / 12));
      let valorANS = valorPago;

      let data = new Date(inicio);

      for (let i = 0; i < diffMeses; i++) {
        const label = formatarMesAno(data);
        meses.push(label);
        valoresPagos.push(valorPago);
        valoresANS.push(valorANS);

        if (data.getMonth() === mesReajuste) {
          valorPago *= 1 + reajusteReal;
          valorANS *= 1 + reajusteANS;
        }

        data.setMonth(data.getMonth() + 1);
      }

      const totalPago = valoresPagos.reduce((a, b) => a + b, 0);
      const totalANS = valoresANS.reduce((a, b) => a + b, 0);
      const dif = totalPago - totalANS;
      const futuroDif = (valorPago * 12) - (valorANS * 12);

      document.getElementById("resultado").innerHTML = `
        <h3>Resultado da Simula√ß√£o</h3>
        <p>Voc√™ pagou <strong>R$ ${dif.toFixed(2)}</strong> a mais nos √∫ltimos <strong>${diffMeses}</strong> meses.</p>
        <p>Se continuar assim, pagar√° <strong>R$ ${futuroDif.toFixed(2)}</strong> a mais nos pr√≥ximos 12 meses.</p>
      `;

      desenharGrafico(meses, valoresPagos, valoresANS);
      enviarPipedrive(nome, plano, email, whatsapp);
    }

    function desenharGrafico(labels, pago, ans) {
      const ctx = document.getElementById('grafico').getContext('2d');
      if (window.meuGrafico) window.meuGrafico.destroy();

      window.meuGrafico = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label: 'Valor Pago', data: pago, borderColor: 'red', fill: false },
            { label: 'Valor Devido pela ANS', data: ans, borderColor: 'green', fill: false }
          ]
        },
        options: {
          responsive: true
        }
      });
    }

    async function enviarPipedrive(nome, plano, email, whatsapp) {
      const token = 'cd9eb8d752c61cc00505aa73e12bbc1f7289b9c0';
      const pipeline_id = 2;
      const stage_id = 30;

      const pessoa = await fetch(`https://api.pipedrive.com/v1/persons?api_token=${token}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: nome, email, phone: whatsapp })
      }).then(res => res.json());

      const personId = pessoa?.data?.id;

      if (personId) {
        await fetch(`https://api.pipedrive.com/v1/deals?api_token=${token}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            title: `Simula√ß√£o - ${nome}`,
            person_id: personId,
            pipeline_id,
            stage_id
          })
        });
      }
    }

    function exportarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text(document.getElementById("resultado").innerText, 10, 10);
      doc.save("simulacao-saude.pdf");
    }

    function compartilharWhatsApp() {
      const nome = document.getElementById('nomeCliente').value;
      const plano = document.getElementById('nomePlano').value;
      const link = window.location.href;
      const texto = `Ol√°! Fiz uma simula√ß√£o no Sa√∫de Transparente e identifiquei um poss√≠vel reajuste abusivo no meu plano ${plano}.\nVeja: ${link}`;
      const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(texto)}`;
      window.open(url, '_blank');
    }
  </script>

</body>
</html>
