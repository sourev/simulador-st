<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador de Reajuste Indevido - Sourev</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #f5f5f5;
      padding: 20px;
    }
    .logo {
      max-width: 200px;
      margin-bottom: 20px;
    }
    .form-section {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
    }
    .result {
      margin-top: 30px;
    }
    .btn-whatsapp {
      background-color: #25D366;
      color: white;
    }
  </style>
</head>
<body>

  <div class="container">
    <img src="logo.png" alt="Logo Sourev" class="logo"/>

    <div class="form-section">
      <h3>Simulador de Reajuste Indevido de Plano de Sa√∫de</h3>
      <form id="simuladorForm">
        <div class="row">
          <div class="col-md-4">
            <label>Data de Inclus√£o no Plano</label>
            <input type="month" class="form-control" id="dataInclusao" required>
          </div>
          <div class="col-md-4">
            <label>Data do √öltimo Pagamento</label>
            <input type="month" class="form-control" id="dataUltimoPagamento" required>
          </div>
          <div class="col-md-4">
            <label>Valor da √öltima Mensalidade (R$)</label>
            <input type="number" class="form-control" id="valorMensalidade" required>
          </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3">Simular</button>
      </form>
    </div>

    <div class="result" id="resultadoSimulacao" style="display: none;">
      <h4 class="mt-4">Resultado da Simula√ß√£o</h4>
      <p id="textoResumo"></p>
      <canvas id="graficoComparativo" height="100"></canvas>

      <div class="mt-4">
        <button onclick="gerarPDF()" class="btn btn-outline-secondary">üì§ Exportar PDF</button>
        <a id="linkWhatsapp" target="_blank" class="btn btn-whatsapp">üì≤ Compartilhar no WhatsApp</a>
      </div>
    </div>
  </div>

  <script>
    const indicesANS = {
      "2024": 6.91,
      "2023": 9.63,
      "2022": 15.50,
      "2021": -8.19,
      "2020": 8.14,
      "2019": 7.35,
      "2018": 10.00,
      "2017": 13.55,
      "2016": 13.57,
      "2015": 13.55,
      "2014": 9.65,
      "2013": 9.04,
      "2012": 7.93,
      "2011": 7.69,
      "2010": 6.73
    };

    function aplicarIndiceReverso(valorFinal, indices) {
      let valor = valorFinal;
      let valores = [];
      for (let i = indices.length - 1; i >= 0; i--) {
        valor = valor / (1 + indices[i] / 100);
        valores.unshift(valor.toFixed(2));
      }
      return valores;
    }

    function gerarPDF() {
      window.print();
    }

    document.getElementById("simuladorForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const dataInicio = new Date(document.getElementById("dataInclusao").value + "-01");
      const dataFim = new Date(document.getElementById("dataUltimoPagamento").value + "-01");
      const valorAtual = parseFloat(document.getElementById("valorMensalidade").value);

      let meses = [];
      let indicesAplicados = [];
      let datas = [];

      let cursor = new Date(dataFim);
      cursor.setDate(1);

      while (cursor >= dataInicio) {
        const anoBase = cursor.getMonth() < 9 ? cursor.getFullYear() - 1 : cursor.getFullYear();
        const indice = indicesANS[anoBase] !== undefined ? indicesANS[anoBase] : 7.0;
        indicesAplicados.unshift(indice);
        datas.unshift(new Date(cursor));
        cursor.setMonth(cursor.getMonth() - 1);
      }

      const valoresANS = aplicarIndiceReverso(valorAtual, indicesAplicados.map(i => i));
      const valorTotalANS = valoresANS.reduce((sum, v) => sum + parseFloat(v), 0);
      const valorTotalPago = valorAtual * valoresANS.length;
      const valorRestituicao = valorTotalPago - valorTotalANS;

      // Texto explicativo
      document.getElementById("textoResumo").innerHTML = `
        <strong>Voc√™ pagou R$ ${valorRestituicao.toFixed(2)} a mais</strong> nos √∫ltimos ${valoresANS.length} meses.<br>
        <strong>Se continuar assim, pagar√° R$ ${(valorAtual * 12 - valoresANS.slice(-12).reduce((s,v)=>s+parseFloat(v), 0)).toFixed(2)} a mais nos pr√≥ximos 12 meses.</strong>
      `;

      // Gr√°fico
      const labels = datas.map(d => `${d.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' })}`);
      const real = new Array(valoresANS.length).fill(valorAtual);
      const ans = valoresANS.map(v => parseFloat(v));

      const ctx = document.getElementById("graficoComparativo").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [
            {
              label: "Valor Pago",
              data: real,
              backgroundColor: "#6f42c1"
            },
            {
              label: "Valor pela ANS",
              data: ans,
              backgroundColor: "#fd7e14"
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "top" }
          }
        }
      });

      // WhatsApp
      document.getElementById("linkWhatsapp").href = `https://wa.me/?text=Voc√™ pagou R$ ${valorRestituicao.toFixed(2)} a mais no seu plano de sa√∫de! Fa√ßa sua simula√ß√£o com a Sourev.`;

      document.getElementById("resultadoSimulacao").style.display = "block";
    });
  </script>
</body>
</html>
