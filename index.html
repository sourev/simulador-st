<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador de Reajuste Indevido</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    .form-group {
      margin-bottom: 10px;
    }
    label {
      font-weight: bold;
    }
    input, select {
      padding: 6px;
      width: 100%;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      margin-top: 10px;
    }
    #resultado {
      background-color: #eef3f8;
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
    }
    #grafico {
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <h2>Simulador de Reajuste Indevido de Plano de Saúde</h2>

  <div class="form-group">
    <label>Data de Inclusão no Plano:</label>
    <input type="month" id="dataInicio" value="2020-11">
  </div>

  <div class="form-group">
    <label>Data do Último Pagamento:</label>
    <input type="month" id="dataFim" value="2025-02">
  </div>

  <div class="form-group">
    <label>Valor da Última Mensalidade (R$):</label>
    <input type="number" id="valorAtual" value="4000">
  </div>

  <button onclick="simular()">Simular</button>

  <div id="resultado"></div>

  <canvas id="grafico" height="100"></canvas>

  <script>
    const reajusteANS = {
      2024: 6.91,
      2023: 9.63,
      2022: 15.50,
      2021: -8.19,
      2020: 8.14,
      2019: 7.35,
      2018: 10.00,
      2017: 13.55,
      2016: 13.57,
      2015: 13.55,
      2014: 9.65,
      2013: 9.04,
      2012: 7.93,
      2011: 7.69,
      2010: 6.73,
      2009: 6.76,
      2008: 5.48,
      2007: 5.76,
      2006: 8.89,
      2005: 11.69,
      2004: 11.75,
      2003: 9.27,
      2002: 7.69,
      2001: 8.71,
      2000: 5.42
    };

    function simular() {
      const dataInicio = new Date(document.getElementById("dataInicio").value + "-01");
      const dataFim = new Date(document.getElementById("dataFim").value + "-01");
      const valorAtual = parseFloat(document.getElementById("valorAtual").value);
      const meses = [];
      const pago = [];
      const ans = [];

      let data = new Date(dataFim);
      let valorPago = valorAtual;

      // REGRESSIVO (Valor Pago com reajuste real 22% ao ano, só em outubro)
      while (data >= dataInicio) {
        meses.unshift(data.toLocaleDateString("pt-BR", { month: '2-digit', year: 'numeric' }));
        pago.unshift(parseFloat(valorPago.toFixed(2)));

        if (data.getMonth() === 9) { // Outubro
          valorPago = valorPago / 1.22;
        }

        data.setMonth(data.getMonth() - 1);
      }

      // PROGRESSIVO (Valor devido ANS com base no valor inicial)
      let data2 = new Date(dataInicio);
      let valorInicial = pago[0];
      let valorANS = valorInicial;

      while (data2 <= dataFim) {
        ans.push(parseFloat(valorANS.toFixed(2)));

        if (data2.getMonth() === 9) { // Outubro
          const ano = data2.getFullYear();
          const indice = reajusteANS[ano] ?? 7;
          valorANS *= (1 + indice / 100);
        }

        data2.setMonth(data2.getMonth() + 1);
      }

      const totalPago = pago.reduce((a, b) => a + b, 0);
      const totalANS = ans.reduce((a, b) => a + b, 0);
      const diferenca = totalPago - totalANS;

      const valor12ProxMeses = pago.slice(-12).reduce((a, b) => a + b, 0);
      const valorANS12Meses = ans.slice(-12).reduce((a, b) => a + b, 0);
      const difProx12 = valor12ProxMeses - valorANS12Meses;

      document.getElementById("resultado").innerHTML = `
        <h3>Resultado da Simulação</h3>
        <p>Você pagou <strong>R$ ${diferenca.toFixed(2)}</strong> a mais nos últimos <strong>${pago.length}</strong> meses.</p>
        <p>Se continuar assim, pagará <strong>R$ ${difProx12.toFixed(2)}</strong> a mais nos próximos 12 meses.</p>
      `;

      const ctx = document.getElementById("grafico").getContext("2d");
      if (window.chartInstance) window.chartInstance.destroy();
      window.chartInstance = new Chart(ctx, {
        type: "line",
        data: {
          labels: meses,
          datasets: [
            {
              label: "Valor Pago",
              data: pago,
              borderColor: "red",
              fill: false,
              tension: 0.2
            },
            {
              label: "Valor que deveria ser pago (ANS)",
              data: ans,
              borderColor: "green",
              fill: false,
              tension: 0.2
            }
          ]
        }
      });
    }
  </script>
</body>
</html>
