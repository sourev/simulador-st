<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador Reajuste de Plano de SaÃºde</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      max-width: 900px;
      margin: auto;
    }
    img.logo {
      max-width: 180px;
      margin-bottom: 20px;
    }
    h1 {
      color: #1a237e;
    }
    input, button {
      padding: 8px;
      margin: 5px 0;
    }
    canvas {
      max-width: 100%;
    }
    .result {
      background-color: #f3f3f3;
      padding: 15px;
      margin-top: 15px;
      border-radius: 8px;
    }
    .btns {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <img src="logo.png" alt="Logo" class="logo">
  <h1>Simulador de Reajuste Indevido de Plano de SaÃºde</h1>

  <label>ðŸ“… Data de InclusÃ£o no Plano:</label><br>
  <input type="month" id="inicio" value="2020-11"><br>

  <label>ðŸ“… Data do Ãšltimo Pagamento:</label><br>
  <input type="month" id="fim" value="2025-02"><br>

  <label>ðŸ’° Valor da Ãšltima Mensalidade:</label><br>
  <input type="number" id="valorFinal" value="4000"><br>

  <div class="btns">
    <button onclick="calcular()">Simular</button>
    <button onclick="gerarPDF()">ðŸ“¤ Exportar PDF</button>
    <button onclick="compartilhar()">ðŸ“² Compartilhar WhatsApp</button>
  </div>

  <div class="result" id="resultado" style="display:none;"></div>
  <canvas id="grafico" height="100"></canvas>

  <script>
    const indicesANS = {
      "2024": 6.91,
      "2023": 9.63,
      "2022": 15.50,
      "2021": -8.19,
      "2020": 8.14,
      "2019": 7.35,
      "2018": 10.00,
      "2017": 13.55,
      "2016": 13.57,
      "2015": 13.55,
      "2014": 9.65,
      "2013": 9.04,
      "2012": 7.93,
      "2011": 7.69,
      "2010": 6.73,
      "2009": 6.76,
      "2008": 5.48,
      "2007": 5.76,
      "2006": 8.89,
      "2005": 11.69,
      "2004": 11.75,
      "2003": 9.27,
      "2002": 7.69,
      "2001": 8.71,
      "2000": 5.42
    };

    function calcular() {
      const inicio = new Date(document.getElementById('inicio').value + "-01");
      const fim = new Date(document.getElementById('fim').value + "-01");
      const valorFinal = parseFloat(document.getElementById('valorFinal').value);

      let atual = new Date(fim);
      let dados = [];
      let valorPago = valorFinal;

      while (atual >= inicio) {
        const ano = atual.getFullYear();
        const mes = atual.getMonth();
        const key = `${ano}-${mes+1}`;

        // Reajuste REAL de 20% ao ano, proporcional mensal
        valorPago = parseFloat((valorPago / Math.pow(1.20, 1/12)).toFixed(2));

        dados.unshift({
          mesAno: atual.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' }),
          ano: ano,
          mes: mes,
          valorPago: valorPago
        });

        atual.setMonth(atual.getMonth() - 1);
      }

      // Valor pela ANS parte do valor pago no mÃªs de entrada
      let valorANS = dados[0].valorPago;

      dados.forEach((dado, i) => {
        const ano = dado.ano;
        const mes = dado.mes;

        if (mes === 9 && indicesANS[ano]) { // outubro (9)
          valorANS *= 1 + (indicesANS[ano] / 100);
        } else if (mes === 9) {
          valorANS *= 1 + (0.07); // fallback mÃ©dia 7%
        }

        dado.valorANS = parseFloat(valorANS.toFixed(2));
        dado.diferenca = parseFloat((dado.valorPago - valorANS).toFixed(2));
      });

      const totalPago = dados.reduce((acc, cur) => acc + cur.valorPago, 0);
      const totalANS = dados.reduce((acc, cur) => acc + cur.valorANS, 0);
      const totalDif = totalPago - totalANS;

      document.getElementById('resultado').style.display = 'block';
      document.getElementById('resultado').innerHTML = `
        <strong>ðŸ“Œ Resultado:</strong><br>
        VocÃª pagou <b>R$ ${totalDif.toFixed(2)}</b> a mais nos Ãºltimos ${dados.length} meses.<br>
        Se continuar assim, pagarÃ¡ R$ ${(totalDif / dados.length * 12).toFixed(2)} a mais nos prÃ³ximos 12 meses.
      `;

      const ctx = document.getElementById('grafico').getContext('2d');
      if (window.graficoAtual) window.graficoAtual.destroy();
      window.graficoAtual = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: dados.map(d => d.mesAno),
          datasets: [
            {
              label: 'Valor Pago',
              data: dados.map(d => d.valorPago),
              backgroundColor: '#f44336'
            },
            {
              label: 'Valor Pela ANS',
              data: dados.map(d => d.valorANS),
              backgroundColor: '#4caf50'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' }
          }
        }
      });
    }

    function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.text("Simulador de Reajuste Indevido", 10, 10);
      doc.addImage(document.querySelector('.logo'), 'PNG', 150, 5, 40, 15);

      doc.html(document.getElementById('resultado'), {
        callback: function () {
          doc.addPage();
          const canvas = document.querySelector('#grafico');
          const imgData = canvas.toDataURL('image/png');
          doc.addImage(imgData, 'PNG', 10, 20, 180, 100);
          doc.save("simulador-plano-saude.pdf");
        }
      });
    }

    function compartilhar() {
      const texto = encodeURIComponent("Descubra se vocÃª estÃ¡ pagando mais do que deveria no seu plano de saÃºde: https://seusite.com/simulador");
      window.open(`https://wa.me/?text=${texto}`, "_blank");
    }
  </script>
</body>
</html>
