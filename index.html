<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Reajuste Abusivo</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fb;
      padding: 30px;
      color: #1f2e4d;
    }
    h1 {
      text-align: center;
      color: #1f2e4d;
    }
    form {
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }
    .result-box {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    canvas {
      max-width: 700px;
      margin: 30px auto;
      display: block;
    }
  </style>
</head>
<body>
  <h1>Simulador de Reajuste Abusivo<br>Plano de Saúde</h1>

  <form id="form">
    <label>Nome da Empresa:</label>
    <input type="text" id="empresa" placeholder="Ex: Clínica MMJ" required>

    <label>Data de Inclusão no Plano:</label>
    <input type="month" id="dataInicio" required>

    <label>Data do Último Pagamento:</label>
    <input type="month" id="dataFim" required>

    <label>Valor da Última Mensalidade (R$):</label>
    <input type="number" id="valorAtual" required>

    <button type="submit" style="background-color:#1f2e4d;color:white;">Simular</button>
  </form>

  <div id="resultado" class="result-box" style="display:none;"></div>
  <canvas id="grafico" height="100"></canvas>

  <script>
    const indicesANS = {
      "2024-2025": 0.0691,
      "2023-2024": 0.0963,
      "2022-2023": 0.1550,
      "2021-2022": -0.0819,
      "2020-2021": 0.0814,
      "2019-2020": 0.0735,
      "2018-2019": 0.10,
      "2017-2018": 0.1355,
      "2016-2017": 0.1357,
      "2015-2016": 0.1355,
      "2014-2015": 0.0965,
      "2013-2014": 0.0904,
      "2012-2013": 0.0793,
      "2011-2012": 0.0769,
      "2010-2011": 0.0673,
      "2009-2010": 0.0676,
      "2008-2009": 0.0548,
      "2007-2008": 0.0576,
      "2006-2007": 0.0889,
      "2005-2006": 0.1169,
      "2004-2005": 0.1175,
      "2003-2004": 0.0927,
      "2002-2003": 0.0769,
      "2001-2002": 0.0871,
      "2000-2001": 0.0542
    };

    function obterIndiceAno(ano) {
      const intervalo = Object.keys(indicesANS).find(i => i.includes(ano));
      return indicesANS[intervalo] ?? 0.05;
    }

    document.getElementById('form').addEventListener('submit', function(e){
      e.preventDefault();

      const dataInicio = new Date(document.getElementById('dataInicio').value + "-01");
      const dataFim = new Date(document.getElementById('dataFim').value + "-01");
      const valorAtual = parseFloat(document.getElementById('valorAtual').value);

      let meses = [];
      let pagos = [];
      let ans = [];

      const mesesTotais = Math.round((dataFim - dataInicio) / (1000 * 60 * 60 * 24 * 30)) + 1;

      let valor = valorAtual;
      for (let i = 0; i < mesesTotais; i++) {
        const ref = new Date(dataFim.getFullYear(), dataFim.getMonth() - i, 1);
        const anoRef = ref.getFullYear();
        const key = Object.keys(indicesANS).find(k => k.includes(anoRef));
        const indice = indicesANS[key] ?? 0.05;
        valor = valor / (1 + indice); // Corrigindo ao contrário para simular o passado
        meses.unshift(ref.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' }));
        pagos.unshift(valorAtual);
        ans.unshift(valor);
      }

      const totalPago = pagos.reduce((a, b) => a + b, 0);
      const totalDevido = ans.reduce((a, b) => a + b, 0);
      const diferenca = totalPago - totalDevido;
      const diferencaMensal = valorAtual - ans[ans.length - 1];
      const diferenca12Meses = diferencaMensal * 12;

      document.getElementById("resultado").style.display = "block";
      document.getElementById("resultado").innerHTML = `
        <h3>Resultado:</h3>
        <p>Você pagou <strong>R$ ${diferenca.toFixed(2)}</strong> a mais nos últimos <strong>${mesesTotais}</strong> meses.</p>
        <p>Se continuar assim, pagará <strong>R$ ${diferenca12Meses.toFixed(2)}</strong> a mais nos próximos 12 meses.</p>
      `;

      const ctx = document.getElementById('grafico').getContext('2d');
      if (window.chartSimulador) window.chartSimulador.destroy();
      window.chartSimulador = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ["Total Pago", "Valor Devido (ANS)", "Diferença Total"],
          datasets: [{
            label: "Valores em R$",
            data: [totalPago, totalDevido, diferenca],
            backgroundColor: ["#e74c3c", "#3498db", "#2ecc71"]
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    });
  </script>
</body>
</html>
