<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador de Reajuste Abusivo - Sa√∫de Transparente</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f8fc;
      padding: 30px;
      text-align: center;
    }
    img.logo {
      max-width: 180px;
      margin-bottom: 10px;
    }
    h1 {
      color: #17385f;
      margin: 0;
    }
    form {
      max-width: 500px;
      margin: 0 auto;
      text-align: left;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      width: 100%;
      padding: 12px;
      background: #17385f;
      color: #fff;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }
    #resultado {
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      font-size: 16px;
      text-align: left;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }
    canvas {
      margin-top: 30px;
      max-width: 700px;
    }
  </style>
</head>
<body>

  <img src="https://i.imgur.com/Hrx8FG2.png" alt="Logo Sa√∫de Transparente" class="logo"/>
  <h1>Simulador de Reajuste Abusivo <br>Plano de Sa√∫de</h1>

  <form onsubmit="event.preventDefault(); calcular();">
    <label>Nome da Empresa:</label>
    <input type="text" id="empresa" placeholder="Ex: Cl√≠nica MMJ" required />

    <label>Data de Inclus√£o no Plano:</label>
    <input type="month" id="dataInicio" required />

    <label>Data do √öltimo Pagamento:</label>
    <input type="month" id="dataFim" required />

    <label>Valor da √öltima Mensalidade (R$):</label>
    <input type="number" id="valorMensalidade" required />

    <button type="submit">Simular</button>
  </form>

  <div id="resultado"></div>

  <canvas id="graficoComparativo"></canvas>

  <button onclick="exportarPDFComGrafico()">üì§ Exportar PDF</button>

  <script>
    const indicesANS = {
      2020: 0.0814,
      2021: -0.0819,
      2022: 0.1550,
      2023: 0.0963,
      2024: 0.0691
    };

    function calcular() {
      const inicio = new Date(document.getElementById("dataInicio").value);
      const fim = new Date(document.getElementById("dataFim").value);
      const mensalidadeAtual = parseFloat(document.getElementById("valorMensalidade").value);

      const meses = [];
      let atual = new Date(inicio);
      while (atual <= fim) {
        meses.push(new Date(atual));
        atual.setMonth(atual.getMonth() + 1);
      }

      let valor = mensalidadeAtual;
      let valorANS = mensalidadeAtual;
      let totalPago = 0;
      let totalDevido = 0;

      // Assume reajuste de 25% por ano pelo plano
      const percentualReajustePlano = 0.25;

      for (let i = meses.length - 1; i >= 0; i--) {
        const mesRef = meses[i];
        const ano = mesRef.getFullYear();
        const mes = mesRef.getMonth();

        // Aplica o reajuste ANUAL do PLANO
        if (mes === 10 && i !== meses.length - 1) { // Novembro
          valor /= (1 + percentualReajustePlano);
        }

        // Aplica reajuste da ANS se existir
        if (mes === 10 && indicesANS[ano]) {
          valorANS /= (1 + indicesANS[ano]);
        }

        totalPago += valor;
        totalDevido += valorANS;
      }

      const diferenca = totalPago - totalDevido;
      const futuro12Meses = (mensalidadeAtual - valorANS) * 12;

      document.getElementById("resultado").innerHTML = `
        <strong>Resultado:</strong><br/>
        Voc√™ pagou <strong>R$ ${diferenca.toFixed(2)}</strong> a mais nos √∫ltimos <strong>${meses.length}</strong> meses.<br/>
        Se continuar assim, pagar√° <strong>R$ ${futuro12Meses.toFixed(2)}</strong> a mais nos pr√≥ximos 12 meses.
      `;

      gerarGrafico(totalPago, totalDevido, diferenca);
    }

    let chart;

    function gerarGrafico(pago, ans, dif) {
      const ctx = document.getElementById("graficoComparativo").getContext("2d");
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["Total Pago", "Valor Devido (ANS)", "Diferen√ßa Total"],
          datasets: [{
            label: "Valores em R$",
            data: [pago, ans, dif],
            backgroundColor: ["#e74c3c", "#3498db", "#2ecc71"]
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    async function exportarPDFComGrafico() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const logo = new Image();
      logo.src = "https://i.imgur.com/Hrx8FG2.png";
      await new Promise(resolve => logo.onload = resolve);
      doc.addImage(logo, "PNG", 15, 10, 40, 20);

      doc.setFontSize(16);
      doc.text("Simulador de Reajuste Abusivo - Sa√∫de Transparente", 15, 40);

      const resultadoTexto = document.getElementById("resultado").innerText;
      const linhas = doc.splitTextToSize(resultadoTexto, 180);
      doc.setFontSize(12);
      doc.text(linhas, 15, 50);

      const canvas = document.getElementById("graficoComparativo");
      const imgData = canvas.toDataURL("image/png");
      doc.addImage(imgData, 'PNG', 15, 90, 180, 80);

      doc.save("simulacao-saude-transparente.pdf");
    }
  </script>

</body>
</html>
