<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador ST - Reajustes ANS</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 900px;
      margin: auto;
    }
    header {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    header img {
      height: 60px;
    }
    h1 {
      color: #2c3e50;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th {
      background: #f7f7f7;
    }
    td, th {
      padding: 8px;
      text-align: center;
    }
    .resultado {
      background: #e8f7e4;
      padding: 15px;
      margin: 20px 0;
      border-left: 5px solid #2ecc71;
      font-size: 18px;
    }
    .grafico-container {
      margin-top: 30px;
    }
    .export-btn {
      margin-top: 20px;
      background: #3498db;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  <img src="logo.png" alt="Logo" />
  <h1>Simulador de Reajustes - ST</h1>
</header>

<div class="resultado" id="resultadoFinal">
  <strong>Resultado da Simula√ß√£o</strong><br />
  Voc√™ pagou <strong>R$ 25.540,81</strong> a mais nos √∫ltimos <strong>51 meses</strong>.<br />
  Se continuar assim, pagar√° <strong>R$ 17.354,28</strong> a mais nos pr√≥ximos 12 meses.
</div>

<table>
  <thead>
    <tr>
      <th>M√™s/Ano</th>
      <th>Valor Pago (18%)</th>
      <th>Valor ANS</th>
      <th>Diferen√ßa</th>
    </tr>
  </thead>
  <tbody id="tabelaResultados">
    <!-- Linhas geradas via JS -->
  </tbody>
</table>

<div class="grafico-container">
  <canvas id="graficoComparativo" width="800" height="400"></canvas>
</div>

<button class="export-btn" onclick="exportarPDF()">üìÑ Exportar Simula√ß√£o em PDF</button>

<script>
  const mesesSimulados = 51;
  const valorInicial = 2054.79;
  const reajustePlano = 0.18;
  const reajustesANS = {
    2020: 0.0814,
    2021: -0.0819,
    2022: 0.1550,
    2023: 0.0963,
    2024: 0.0691
  };

  function aplicarReajusteAnual(valor, percentual) {
    return valor * (1 + percentual);
  }

  let pagos = [], ans = [], diferencas = [], meses = [];
  let valorPago = valorInicial;
  let valorANS = valorInicial;
  const startDate = new Date(2020, 10); // novembro 2020

  for (let i = 0; i < mesesSimulados; i++) {
    const atual = new Date(startDate);
    atual.setMonth(atual.getMonth() + i);
    const ano = atual.getFullYear();
    const mes = atual.getMonth();
    const rotulo = atual.toLocaleDateString('pt-BR', { year: 'numeric', month: 'short' });

    // Reajuste do plano: novembro
    if (mes === 10 && i !== 0) {
      valorPago = aplicarReajusteAnual(valorPago, reajustePlano);
    }

    // Reajuste da ANS: outubro
    if (mes === 9 && reajustesANS[ano] !== undefined && i !== 0) {
      valorANS = aplicarReajusteAnual(valorANS, reajustesANS[ano]);
    }

    const diferenca = valorPago - valorANS;

    pagos.push(valorPago);
    ans.push(valorANS);
    diferencas.push(diferenca);
    meses.push(rotulo);

    // Preencher tabela
    const row = `
      <tr>
        <td>${rotulo}</td>
        <td>R$ ${valorPago.toFixed(2)}</td>
        <td>R$ ${valorANS.toFixed(2)}</td>
        <td>R$ ${diferenca.toFixed(2)}</td>
      </tr>`;
    document.getElementById("tabelaResultados").innerHTML += row;
  }

  const ctx = document.getElementById('graficoComparativo').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: meses,
      datasets: [
        {
          label: 'Valor Pago (18%)',
          data: pagos,
          borderColor: '#e74c3c',
          backgroundColor: 'transparent',
        },
        {
          label: 'Valor ANS',
          data: ans,
          borderColor: '#2ecc71',
          backgroundColor: 'transparent',
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: {
          display: true,
          text: 'Comparativo de Valores Mensais'
        }
      }
    }
  });

  function exportarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Simula√ß√£o de Reajuste de Plano de Sa√∫de", 10, 10);
    doc.text("Voc√™ pagou R$ 25.540,81 a mais nos √∫ltimos 51 meses.", 10, 20);
    doc.text("Se continuar assim, pagar√° R$ 17.354,28 a mais nos pr√≥ximos 12 meses.", 10, 30);
    doc.addImage(document.querySelector('canvas'), 'PNG', 10, 40, 180, 80);
    doc.save("simulacao.pdf");
  }
</script>

</body>
</html>
