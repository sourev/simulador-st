<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador de Reajuste de Plano de SaÃºde</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background: #f5f5f5;
    }
    h1 {
      color: #004aad;
    }
    label {
      display: block;
      margin-top: 20px;
    }
    input {
      padding: 8px;
      width: 250px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #004aad;
      color: white;
      border: none;
      cursor: pointer;
    }
    .logo {
      width: 180px;
      margin-bottom: 20px;
    }
    #resultado {
      background: white;
      padding: 30px;
      margin-top: 40px;
      border-radius: 8px;
    }
    canvas {
      max-width: 100%;
    }
  </style>
</head>
<body>

  <img src="logo.png" alt="Logo" class="logo"/>

  <h1>Simulador de Reajuste de Plano de SaÃºde (Falso Coletivo)</h1>

  <label>ðŸ“… Data de InclusÃ£o no Plano:</label>
  <input type="month" id="dataInclusao" value="2020-11" />

  <label>ðŸ“… Data do Ãšltimo Pagamento:</label>
  <input type="month" id="dataFinal" value="2025-02" />

  <label>ðŸ’° Valor da Ãšltima Mensalidade:</label>
  <input type="number" id="valorMensalidade" value="4000" />

  <button onclick="simular()">Simular</button>
  <button onclick="exportarPDF()">ðŸ“„ Exportar SimulaÃ§Ã£o em PDF</button>

  <div id="resultado" style="display:none;">
    <h2>ðŸ“Š Resultado da SimulaÃ§Ã£o</h2>
    <p id="infoValores"></p>
    <canvas id="grafico"></canvas>
  </div>

  <script>
    const indicesANS = {
      2024: 0.0691,
      2023: 0.0963,
      2022: 0.1550,
      2021: -0.0819,
      2020: 0.0814,
      2019: 0.0735,
      2018: 0.10,
      2017: 0.1355,
      2016: 0.1357,
      2015: 0.1355,
      2014: 0.0965,
      2013: 0.0904,
      2012: 0.0793,
      2011: 0.0769,
      2010: 0.0673,
      2009: 0.0676,
      2008: 0.0548,
      2007: 0.0576,
      2006: 0.0889,
      2005: 0.1169,
      2004: 0.1175,
      2003: 0.0927,
      2002: 0.0769,
      2001: 0.0871,
      2000: 0.0542,
    };

    const mediaIndiceANS = 0.07; // fallback
    const REAJUSTE_REAL_ANUAL = 0.18; // reajuste real fixo
    const MESES_POR_ANO = 12;

    function simular() {
      const dataInicio = new Date(document.getElementById('dataInclusao').value + "-01");
      const dataFim = new Date(document.getElementById('dataFinal').value + "-01");
      const valorFinal = parseFloat(document.getElementById('valorMensalidade').value);

      const meses = [];
      const valoresReais = [];
      const valoresANS = [];

      let valorAtual = valorFinal;

      const totalMeses = Math.floor((dataFim.getFullYear() - dataInicio.getFullYear()) * 12 + (dataFim.getMonth() - dataInicio.getMonth()));

      for (let i = 0; i <= totalMeses; i++) {
        const data = new Date(dataFim);
        data.setMonth(data.getMonth() - i);
        const ano = data.getFullYear();
        const mes = data.getMonth();

        const mesAno = data.toLocaleString('pt-BR', { month: 'short', year: 'numeric' });

        meses.unshift(mesAno);

        // Reajuste regressivo real (18%)
        valoresReais.unshift(valorAtual.toFixed(2));
        valorAtual = valorAtual / (1 + REAJUSTE_REAL_ANUAL / MESES_POR_ANO);

        // Reajuste pela ANS
        const anoBase = mes >= 9 ? ano + 1 : ano;
        const indiceAnual = indicesANS[anoBase] !== undefined ? indicesANS[anoBase] : mediaIndiceANS;

        if (i === totalMeses) {
          valorANS = valorAtual; // valor inicial
        }

        if (valoresANS.length === 0) {
          valoresANS.unshift(valorAtual.toFixed(2));
        } else {
          const proximo = parseFloat(valoresANS[0]);
          const anterior = proximo / (1 + indiceAnual / MESES_POR_ANO);
          valoresANS.unshift(anterior.toFixed(2));
        }
      }

      // Calcular totais
      const totalPago = valoresReais.reduce((soma, v) => soma + parseFloat(v), 0);
      const totalDevido = valoresANS.reduce((soma, v) => soma + parseFloat(v), 0);
      const diferenca = totalPago - totalDevido;

      document.getElementById('infoValores').innerHTML = `
        <p>ðŸ’¸ <strong>Total pago:</strong> R$ ${totalPago.toFixed(2)}</p>
        <p>âœ… <strong>Valor devido conforme ANS:</strong> R$ ${totalDevido.toFixed(2)}</p>
        <p>ðŸ“‰ <strong>Valor pago a mais:</strong> <span style="color:red;">R$ ${diferenca.toFixed(2)}</span></p>
      `;

      document.getElementById('resultado').style.display = 'block';

      const ctx = document.getElementById('grafico').getContext('2d');
      if (window.meuGrafico) window.meuGrafico.destroy();
      window.meuGrafico = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: meses,
          datasets: [
            {
              label: 'Mensalidade Real',
              data: valoresReais,
              backgroundColor: 'rgba(255, 99, 132, 0.7)'
            },
            {
              label: 'Mensalidade segundo ANS',
              data: valoresANS,
              backgroundColor: 'rgba(54, 162, 235, 0.7)'
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: false
            }
          }
        }
      });
    }

    function exportarPDF() {
      const element = document.getElementById('resultado');
      const opt = {
        margin:       0.5,
        filename:     'simulacao-plano-saude.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }
  </script>

</body>
</html>
