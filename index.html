<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulador de Reajuste Indevido</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background-color: #f8f9fa;
    }
    h1 {
      text-align: center;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
    }
    label, input, select {
      display: block;
      margin: 0.5rem 0;
    }
    .btn {
      margin-top: 1rem;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    #chartContainer {
      margin-top: 40px;
    }
    #logo {
      max-width: 200px;
      margin: 0 auto 20px auto;
      display: block;
    }
    .actions {
      margin-top: 20px;
    }
    .actions button {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="logo.png" alt="Logo" id="logo"/>
    <h1>Simulador de Reajuste Indevido de Plano de Sa√∫de</h1>

    <label>Data de Inclus√£o no Plano</label>
    <input type="month" id="dataInicio" value="2020-11"/>

    <label>Data do √öltimo Pagamento</label>
    <input type="month" id="dataFim" value="2025-02"/>

    <label>Valor da √öltima Mensalidade (R$)</label>
    <input type="number" id="valorAtual" value="4000"/>

    <button class="btn" onclick="simular()">Simular</button>

    <div id="resultado" style="margin-top: 30px;"></div>

    <div id="chartContainer">
      <canvas id="grafico"></canvas>
    </div>

    <div class="actions">
      <button class="btn" onclick="exportarPDF()">üìÑ Exportar PDF</button>
      <a class="btn" style="background-color: #25D366" href="#" id="whatsappLink" target="_blank">üì± Compartilhar no WhatsApp</a>
    </div>
  </div>

  <script>
    const indiceANS = {
      2020: 0.0814,
      2021: -0.0819,
      2022: 0.1550,
      2023: 0.0963,
      2024: 0.0691
    };
    const reajusteReal = 0.20; // 20%

    function aplicarReajusteReverso(valorFinal, anos) {
      let valor = valorFinal;
      const valores = [];
      for (let i = anos.length - 1; i >= 0; i--) {
        const ano = anos[i];
        if (i !== anos.length - 1) {
          valor = valor / (1 + reajusteReal);
        }
        for (let m = 0; m < 12; m++) {
          valores.unshift(parseFloat(valor.toFixed(2)));
        }
      }
      return valores;
    }

    function simular() {
      const inicio = new Date(document.getElementById("dataInicio").value + "-01");
      const fim = new Date(document.getElementById("dataFim").value + "-01");
      const valorAtual = parseFloat(document.getElementById("valorAtual").value);

      const meses = [];
      const pagos = [];
      const ans = [];
      const anos = [];

      let atual = new Date(inicio);
      let valorANS = 100; // base fict√≠cia
      const valoresANS = [];

      while (atual <= fim) {
        const mes = atual.toLocaleString("pt-BR", { month: "short", year: "numeric" });
        meses.push(mes);
        const ano = atual.getFullYear();

        if (!anos.includes(ano)) anos.push(ano);

        // Valor ANS
        if (atual.getMonth() === 9 && indiceANS[ano]) {
          valorANS *= 1 + indiceANS[ano];
        }
        valoresANS.push(parseFloat(valorANS.toFixed(2)));

        atual.setMonth(atual.getMonth() + 1);
      }

      // Valor pago (real) regressivo
      const valoresPagos = aplicarReajusteReverso(valorAtual, anos);

      for (let i = 0; i < meses.length; i++) {
        pagos.push(valoresPagos[i]);
        ans.push(valoresANS[i]);
      }

      const diferencaTotal = pagos.reduce((acc, val, i) => acc + (val - ans[i]), 0);
      const diferencaFutura = (valorAtual - valorANS.toFixed(2)) * 12;

      document.getElementById("resultado").innerHTML = `
        <h2>Resultado da Simula√ß√£o</h2>
        <p><strong>Voc√™ pagou R$ ${diferencaTotal.toFixed(2)} a mais</strong> nos √∫ltimos ${meses.length} meses.</p>
        <p><strong>Se continuar assim, pagar√° R$ ${diferencaFutura.toFixed(2)} a mais nos pr√≥ximos 12 meses.</strong></p>
      `;

      gerarGrafico(meses, pagos, ans);
      atualizarWhatsappLink(diferencaTotal, diferencaFutura);
    }

    function gerarGrafico(meses, pagos, ans) {
      const ctx = document.getElementById("grafico").getContext("2d");
      if (window.myChart) window.myChart.destroy();
      window.myChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: meses,
          datasets: [
            {
              label: "Valor Pago",
              data: pagos,
              backgroundColor: "rgba(102, 51, 153, 0.7)",
            },
            {
              label: "Valor pela ANS",
              data: ans,
              backgroundColor: "orange",
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
            }
          }
        }
      });
    }

    function exportarPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      pdf.text("Simula√ß√£o de Reajuste Indevido de Plano de Sa√∫de", 10, 10);
      pdf.html(document.querySelector("#resultado"), {
        callback: function (doc) {
          doc.save("simulacao.pdf");
        }
      });
    }

    function atualizarWhatsappLink(total, futuro) {
      const texto = `Simula√ß√£o de Reajuste Indevido:\n\nVoc√™ pagou R$ ${total.toFixed(2)} a mais.\nSe continuar, pagar√° R$ ${futuro.toFixed(2)} nos pr√≥ximos 12 meses.\n\nConfira!`;
      const link = `https://wa.me/?text=${encodeURIComponent(texto)}`;
      document.getElementById("whatsappLink").href = link;
    }
  </script>
</body>
</html>
